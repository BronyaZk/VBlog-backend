# VBlog 博客系统 API 接口文档

## 项目概述

**项目名称**: VBlog 博客系统后端服务  
**技术栈**: Spring Boot 2.2.7 + Spring Security + MyBatis + MySQL  
**版本**: 0.0.1-SNAPSHOT  
**基础URL**: `http://localhost:8080` (默认端口)

## 认证说明

本系统使用 Spring Security 进行身份认证，部分接口需要登录后才能访问。认证方式为基于 Session 的认证。

## 通用响应格式

所有接口都遵循统一的响应格式：

```json
{
  "status": "success|error",
  "msg": "响应消息"
}
```

## 数据模型

### User (用户)
```json
{
  "id": 1,
  "username": "用户名",
  "nickname": "昵称",
  "email": "邮箱",
  "userface": "头像URL",
  "enabled": true,
  "regTime": "2023-01-01T00:00:00.000+00:00",
  "roles": [
    {
      "id": 1,
      "name": "角色名称"
    }
  ]
}
```

### Article (文章)
```json
{
  "id": 1,
  "title": "文章标题",
  "mdContent": "Markdown内容",
  "htmlContent": "HTML内容",
  "summary": "文章摘要",
  "cid": 1,
  "uid": 1,
  "publishDate": "2023-01-01T00:00:00.000+00:00",
  "state": 1,
  "pageView": 100,
  "editTime": "2023-01-01T00:00:00.000+00:00",
  "dynamicTags": ["标签1", "标签2"],
  "nickname": "作者昵称",
  "cateName": "分类名称",
  "tags": [
    {
      "id": 1,
      "tagName": "标签名称"
    }
  ],
  "stateStr": "已发布"
}
```

### Category (分类)
```json
{
  "id": 1,
  "cateName": "分类名称",
  "date": "2023-01-01T00:00:00.000+00:00"
}
```

### Tags (标签)
```json
{
  "id": 1,
  "tagName": "标签名称"
}
```

### Role (角色)
```json
{
  "id": 1,
  "name": "角色名称"
}
```

## API 接口

### 1. 用户认证相关

#### 1.1 用户注册
- **接口地址**: `POST /reg`
- **接口描述**: 用户注册
- **请求参数**:
  ```json
  {
    "username": "用户名",
    "password": "密码",
    "nickname": "昵称",
    "email": "邮箱"
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "注册成功!"
  }
  ```

#### 1.2 登录成功回调
- **接口地址**: `GET /login_success`
- **接口描述**: 登录成功后的回调接口
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "登录成功!"
  }
  ```

#### 1.3 登录失败回调
- **接口地址**: `GET /login_error`
- **接口描述**: 登录失败后的回调接口
- **响应示例**:
  ```json
  {
    "status": "error",
    "msg": "登录失败!"
  }
  ```

#### 1.4 未登录回调
- **接口地址**: `GET /login_page`
- **接口描述**: 未登录时访问受保护接口的回调
- **响应示例**:
  ```json
  {
    "status": "error",
    "msg": "尚未登录，请登录!"
  }
  ```

### 2. 用户信息相关

#### 2.1 获取当前用户名
- **接口地址**: `GET /currentUserName`
- **接口描述**: 获取当前登录用户的昵称
- **认证要求**: 需要登录
- **响应示例**: `"用户昵称"`

#### 2.2 获取当前用户ID
- **接口地址**: `GET /currentUserId`
- **接口描述**: 获取当前登录用户的ID
- **认证要求**: 需要登录
- **响应示例**: `1`

#### 2.3 获取当前用户邮箱
- **接口地址**: `GET /currentUserEmail`
- **接口描述**: 获取当前登录用户的邮箱
- **认证要求**: 需要登录
- **响应示例**: `"user@example.com"`

#### 2.4 检查是否为管理员
- **接口地址**: `GET /isAdmin`
- **接口描述**: 检查当前用户是否为超级管理员
- **认证要求**: 需要登录
- **响应示例**: `true`

### 3. 文章管理相关

#### 3.1 创建文章
- **接口地址**: `POST /article/`
- **接口描述**: 创建新文章
- **认证要求**: 需要登录
- **请求参数**:
  ```json
  {
    "title": "文章标题",
    "mdContent": "Markdown内容",
    "htmlContent": "HTML内容",
    "summary": "文章摘要",
    "cid": 1,
    "state": 1
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "1"
  }
  ```

#### 3.2 上传图片
- **接口地址**: `POST /article/uploadimg`
- **接口描述**: 上传文章图片
- **认证要求**: 需要登录
- **请求参数**: `MultipartFile` 文件
- **响应示例**:
  ```json
  {
    "url": "http://localhost:8080/upload/20231201/xxx.jpg"
  }
  ```

#### 3.3 获取文章列表
- **接口地址**: `GET /article/`
- **接口描述**: 获取文章列表（分页）
- **认证要求**: 需要登录
- **请求参数**:
  - `page`: 页码，默认1
  - `count`: 每页数量，默认6
  - `state`: 文章状态
  - `keywords`: 搜索关键词（可选）
- **响应示例**:
  ```json
  {
    "articles": [
      {
        "id": 1,
        "title": "文章标题",
        "summary": "文章摘要",
        "publishDate": "2023-01-01T00:00:00.000+00:00",
        "pageView": 100,
        "nickname": "作者昵称",
        "cateName": "分类名称"
      }
    ],
    "totalCount": 10
  }
  ```

#### 3.4 获取文章详情
- **接口地址**: `GET /article/{aid}`
- **接口描述**: 根据ID获取文章详情
- **认证要求**: 需要登录
- **路径参数**:
  - `aid`: 文章ID
- **响应示例**: 返回完整的 Article 对象

#### 3.5 删除文章
- **接口地址**: `PUT /article/dustbin`
- **接口描述**: 将文章移至回收站
- **认证要求**: 需要登录
- **请求参数**:
  ```json
  {
    "aids": [1, 2, 3],
    "state": -1
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "删除成功!"
  }
  ```

#### 3.6 恢复文章
- **接口地址**: `PUT /article/restore`
- **接口描述**: 从回收站恢复文章
- **认证要求**: 需要登录
- **请求参数**:
  ```json
  {
    "articleId": 1
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "还原成功!"
  }
  ```

#### 3.7 获取数据统计
- **接口地址**: `GET /article/dataStatistics`
- **接口描述**: 获取文章数据统计信息
- **认证要求**: 需要登录
- **响应示例**:
  ```json
  {
    "categories": ["分类1", "分类2"],
    "ds": [10, 20]
  }
  ```

### 4. 分类管理相关

#### 4.1 获取所有分类
- **接口地址**: `GET /admin/category/all`
- **接口描述**: 获取所有文章分类
- **认证要求**: 需要管理员权限
- **响应示例**:
  ```json
  [
    {
      "id": 1,
      "cateName": "技术",
      "date": "2023-01-01T00:00:00.000+00:00"
    }
  ]
  ```

#### 4.2 删除分类
- **接口地址**: `DELETE /admin/category/{ids}`
- **接口描述**: 删除指定分类（支持批量删除）
- **认证要求**: 需要管理员权限
- **路径参数**:
  - `ids`: 分类ID，多个用逗号分隔
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "删除成功!"
  }
  ```

#### 4.3 添加分类
- **接口地址**: `POST /admin/category/`
- **接口描述**: 添加新分类
- **认证要求**: 需要管理员权限
- **请求参数**:
  ```json
  {
    "cateName": "分类名称"
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "添加成功!"
  }
  ```

#### 4.4 更新分类
- **接口地址**: `PUT /admin/category/`
- **接口描述**: 更新分类信息
- **认证要求**: 需要管理员权限
- **请求参数**:
  ```json
  {
    "id": 1,
    "cateName": "新分类名称"
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "更新成功!"
  }
  ```

### 5. 用户管理相关（管理员）

#### 5.1 根据昵称搜索用户
- **接口地址**: `GET /admin/user`
- **接口描述**: 根据昵称搜索用户
- **认证要求**: 需要管理员权限
- **请求参数**:
  - `nickname`: 用户昵称
- **响应示例**:
  ```json
  [
    {
      "id": 1,
      "username": "用户名",
      "nickname": "昵称",
      "email": "邮箱",
      "enabled": true
    }
  ]
  ```

#### 5.2 根据ID获取用户
- **接口地址**: `GET /admin/user/{id}`
- **接口描述**: 根据ID获取用户详情
- **认证要求**: 需要管理员权限
- **路径参数**:
  - `id`: 用户ID
- **响应示例**: 返回完整的 User 对象

#### 5.3 获取所有角色
- **接口地址**: `GET /admin/roles`
- **接口描述**: 获取所有用户角色
- **认证要求**: 需要管理员权限
- **响应示例**:
  ```json
  [
    {
      "id": 1,
      "name": "超级管理员"
    },
    {
      "id": 2,
      "name": "普通用户"
    }
  ]
  ```

#### 5.4 更新用户状态
- **接口地址**: `PUT /admin/user/enabled`
- **接口描述**: 启用或禁用用户
- **认证要求**: 需要管理员权限
- **请求参数**:
  ```json
  {
    "enabled": true,
    "uid": 1
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "更新成功!"
  }
  ```

#### 5.5 删除用户
- **接口地址**: `DELETE /admin/user/{uid}`
- **接口描述**: 删除指定用户
- **认证要求**: 需要管理员权限
- **路径参数**:
  - `uid`: 用户ID
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "删除成功!"
  }
  ```

#### 5.6 更新用户角色
- **接口地址**: `PUT /admin/user/role`
- **接口描述**: 更新用户角色
- **认证要求**: 需要管理员权限
- **请求参数**:
  ```json
  {
    "uid": 1,
    "rids": [1, 2]
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "更新成功!"
  }
  ```

### 6. 管理员文章管理

#### 6.1 获取所有文章（管理员）
- **接口地址**: `GET /admin/article/all`
- **接口描述**: 管理员获取所有文章（包括已删除）
- **认证要求**: 需要管理员权限
- **请求参数**:
  - `page`: 页码，默认1
  - `count`: 每页数量，默认6
  - `keywords`: 搜索关键词（可选）
- **响应示例**:
  ```json
  {
    "articles": [
      {
        "id": 1,
        "title": "文章标题",
        "summary": "文章摘要",
        "publishDate": "2023-01-01T00:00:00.000+00:00",
        "pageView": 100,
        "nickname": "作者昵称",
        "cateName": "分类名称"
      }
    ],
    "totalCount": 10
  }
  ```

#### 6.2 批量更新文章状态
- **接口地址**: `PUT /admin/article/dustbin`
- **接口描述**: 管理员批量更新文章状态
- **认证要求**: 需要管理员权限
- **请求参数**:
  ```json
  {
    "aids": [1, 2, 3],
    "state": -1
  }
  ```
- **响应示例**:
  ```json
  {
    "status": "success",
    "msg": "删除成功!"
  }
  ```

## 错误码说明

| 状态码 | 说明 |
|--------|------|
| 200 | 请求成功 |
| 401 | 未授权，需要登录 |
| 403 | 禁止访问，权限不足 |
| 404 | 资源不存在 |
| 500 | 服务器内部错误 |

## 注意事项

1. 所有需要认证的接口都需要先登录
2. 管理员相关接口需要超级管理员权限
3. 文件上传接口支持图片格式：jpg, jpeg, png, gif
4. 分页参数从1开始计数
5. 时间格式统一使用 ISO 8601 标准
6. 所有接口都支持 CORS 跨域请求

## 更新日志

- **v0.0.1** (2023-01-01): 初始版本，包含基础功能
